{% comment %}
  Collection/Catalog Structured Data for AI Agents
  Uses Schema.org ItemList and CollectionPage vocabulary

  Parameters:
  - collection: The collection object
{% endcomment %}

{% if collection %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "@id": "{{ shop.url }}{{ collection.url }}",
    "name": {{ collection.title | json }},
    "url": "{{ shop.url }}{{ collection.url }}",
    {% if collection.description != blank %}
    "description": {{ collection.description | strip_html | json }},
    {% endif %}
    {% if collection.image %}
    "image": "{{ collection.image | image_url: width: 2048 }}",
    {% endif %}
    "mainEntity": {
      "@type": "ItemList",
      "name": {{ collection.title | json }},
      "numberOfItems": {{ collection.products_count }},
      "itemListElement": [
        {% for product in collection.products limit: 50 %}
          {% assign product_variant = product.selected_or_first_available_variant %}
          {
            "@type": "ListItem",
            "position": {{ forloop.index }},
            "item": {
              "@type": "Product",
              "@id": "{{ shop.url }}{{ product.url }}",
              "name": {{ product.title | json }},
              "url": "{{ shop.url }}{{ product.url }}",
              {% if product.featured_image %}
              "image": "{{ product.featured_image | image_url: width: 1024 }}",
              {% endif %}
              {% if product.vendor %}
              "brand": {
                "@type": "Brand",
                "name": {{ product.vendor | json }}
              },
              {% endif %}
              "description": {{ product.description | strip_html | truncatewords: 30 | json }},
              "offers": {
                "@type": "Offer",
                "url": "{{ shop.url }}{{ product.url }}",
                "priceCurrency": {{ cart.currency.iso_code | json }},
                "price": "{{ product_variant.price | money_without_currency | remove: ',' }}",
                "availability": "{% if product_variant.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
                "seller": {
                  "@type": "Organization",
                  "name": {{ shop.name | json }}
                }
              }
            }
          }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ]
    },
    "breadcrumb": {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "{{ shop.url }}"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Collections",
          "item": "{{ shop.url }}/collections"
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": {{ collection.title | json }},
          "item": "{{ shop.url }}{{ collection.url }}"
        }
      ]
    }
  }
  </script>
{% endif %}
